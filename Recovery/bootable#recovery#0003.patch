From a8b0d73ae00bd3993a32c62dc62b98eae580fc59 Mon Sep 17 00:00:00 2001
From: Zhigang <zhigang.yu@amlogic.com>
Date: Fri, 9 Nov 2018 14:53:58 +0800
Subject: [PATCH] recovery: fixed can't auto reboot after upgrade[1/1]

PD# SWPL-1932

modify recovery update process.

Change-Id: I478ed386b80fe71ead33da822be3d1d12193f013
---
 recovery.cpp | 13 +++----------
 1 file changed, 3 insertions(+), 10 deletions(-)

diff --git a/recovery.cpp b/recovery.cpp
index c661de6..6a2432c 100644
--- a/recovery.cpp
+++ b/recovery.cpp
@@ -1746,15 +1746,6 @@ int main(int argc, char **argv) {
     if (sideload_auto_reboot) {
       ui->Print("Rebooting automatically.\n");
     }
-  } else if (!just_exit) {
-    // If this is an eng or userdebug build, automatically turn on the text display if no command
-    // is specified. Note that this should be called before setting the background to avoid
-    // flickering the background image.
-    if (is_ro_debuggable()) {
-      ui->ShowText(true);
-    }
-    status = INSTALL_NONE;  // No command specified
-    ui->SetBackground(RecoveryUI::NO_COMMAND);
   }
 
   if (status == INSTALL_ERROR || status == INSTALL_CORRUPT) {
@@ -1772,7 +1763,9 @@ int main(int argc, char **argv) {
   //    without waiting.
   // 4. In all other cases, reboot the device. Therefore, normal users will observe the device
   //    reboot after it shows the "error" screen for 5s.
-  if ((status == INSTALL_NONE && !sideload_auto_reboot) || ui->IsTextVisible()) {
+  if (just_exit) {
+        after = Device::REBOOT;
+  } else if ((status == INSTALL_NONE && !sideload_auto_reboot) || ui->IsTextVisible()) {
     Device::BuiltinAction temp = prompt_and_wait(device, status);
     if (temp != Device::NO_ACTION) {
       after = temp;
-- 
1.9.1

