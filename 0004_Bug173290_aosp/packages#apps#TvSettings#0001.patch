From a0ef4ca9d0ae5ad770e50141ae1d748f8fe936e9 Mon Sep 17 00:00:00 2001
From: Lei Qian <lei.qian@amlogic.com>
Date: Tue, 11 Sep 2018 19:42:16 +0800
Subject: [PATCH] FallbackHome: set tv_user_setup_complete to 1 when firstboot
 [1/1]

PD#173290

    only set it in AOSP version, because we have not user setup APK
in AOSP version

Change-Id: I119328e5bba4fed00219567ae15e1ec462ce80d6
Signed-off-by: Lei Qian <lei.qian@amlogic.com>
---
 Settings/src/com/android/tv/settings/system/FallbackHome.java | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/Settings/src/com/android/tv/settings/system/FallbackHome.java b/Settings/src/com/android/tv/settings/system/FallbackHome.java
index 1cff8ef..571e203 100644
--- a/Settings/src/com/android/tv/settings/system/FallbackHome.java
+++ b/Settings/src/com/android/tv/settings/system/FallbackHome.java
@@ -19,6 +19,7 @@ package com.android.tv.settings.system;
 import android.app.Activity;
 import android.content.BroadcastReceiver;
 import android.content.Context;
+import android.content.ContentResolver;
 import android.content.Intent;
 import android.content.IntentFilter;
 import android.content.pm.ResolveInfo;
@@ -26,8 +27,10 @@ import android.os.Bundle;
 import android.os.Handler;
 import android.os.Message;
 import android.os.RemoteException;
+import android.os.SystemProperties;
 import android.os.UserHandle;
 import android.os.UserManager;
+import android.provider.Settings;
 import android.util.Log;
 
 import com.android.internal.widget.LockPatternUtils;
@@ -61,6 +64,11 @@ public class FallbackHome extends Activity implements RestrictedProfilePinDialog
     private BroadcastReceiver mReceiver = new BroadcastReceiver() {
         @Override
         public void onReceive(Context context, Intent intent) {
+            ContentResolver resolver = context.getContentResolver();
+            if (("1").equals(SystemProperties.get("ro.boot.firstboot"))) {
+                Settings.Secure.putInt(resolver, Settings.Secure.SHOW_IME_WITH_HARD_KEYBOARD, 1);
+            }
+            Settings.Secure.putInt(resolver, Settings.Secure.TV_USER_SETUP_COMPLETE, 1);
             maybeFinish();
         }
     };
-- 
1.9.1

