From c9c8ec8804058689e00c2a5c62d7891bea0a350b Mon Sep 17 00:00:00 2001
From: "qiu.zeng" <qiu.zeng@amlogic.com>
Date: Sat, 30 Mar 2019 15:10:35 +0800
Subject: [PATCH] BT: Resolve Bluetooth Switch Caused by Speaker Connection
 [1/1]

Change-Id: I782afa594bc2d9629576a19da108ef8c44623b11
---
 bta/av/bta_av_aact.cc        | 2 +-
 bta/av/bta_av_act.cc         | 2 +-
 internal_include/bt_target.h | 6 ++++++
 3 files changed, 8 insertions(+), 2 deletions(-)

diff --git a/bta/av/bta_av_aact.cc b/bta/av/bta_av_aact.cc
index 297bba4..beb18aa 100644
--- a/bta/av/bta_av_aact.cc
+++ b/bta/av/bta_av_aact.cc
@@ -3005,7 +3005,7 @@ void bta_av_open_rc(tBTA_AV_SCB* p_scb, tBTA_AV_DATA* p_data) {
       }
     } else {
       /* use main SM for AVRC SDP activities */
-      if (is_new_avrcp_enabled()) {
+      if (is_new_avrcp_enabled() || ADD_AVCTP_CONTROL == FALSE) {
         APPL_TRACE_WARNING("%s: Using the new AVRCP Profile", __func__);
         bluetooth::avrcp::AvrcpService::Get()->ConnectDevice(
             p_scb->PeerAddress());
diff --git a/bta/av/bta_av_act.cc b/bta/av/bta_av_act.cc
index 5625f90..94f1158 100644
--- a/bta/av/bta_av_act.cc
+++ b/bta/av/bta_av_act.cc
@@ -305,7 +305,7 @@ static void bta_av_rc_msg_cback(uint8_t handle, uint8_t label, uint8_t opcode,
  ******************************************************************************/
 uint8_t bta_av_rc_create(tBTA_AV_CB* p_cb, uint8_t role, uint8_t shdl,
                          uint8_t lidx) {
-  if (is_new_avrcp_enabled()) {
+  if (is_new_avrcp_enabled() || ADD_AVCTP_CONTROL == FALSE) {
     APPL_TRACE_WARNING("%s: Skipping RC creation for the old AVRCP profile",
                        __func__);
     return BTA_AV_RC_HANDLE_NONE;
diff --git a/internal_include/bt_target.h b/internal_include/bt_target.h
index cf09b15..c6e79db 100644
--- a/internal_include/bt_target.h
+++ b/internal_include/bt_target.h
@@ -1212,6 +1212,12 @@
 #define AVCT_NUM_CONN 14  // 2 * MaxDevices + 2
 #endif
 
+/* add avctp control function */
+#ifndef ADD_AVCTP_CONTROL
+#define ADD_AVCTP_CONTROL  FALSE
+#endif
+
+
 /******************************************************************************
  *
  * AVRCP
-- 
1.9.1

